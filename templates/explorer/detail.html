{% extends "base.html" %}
{% load static %}

{% block title %}{{ place.name }} ‚Äì Explorer{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .detail-hero {
        position: relative;
        border-radius: 24px;
        overflow: hidden;
        margin-bottom: 2rem;
        max-height: 480px;
    }

    .detail-hero img {
        width: 100%;
        height: 480px;
        object-fit: cover;
        display: block;
    }

    .detail-hero .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 2rem;
        background: linear-gradient(to top, rgba(15, 23, 42, 0.95) 0%, transparent 100%);
    }

    .detail-hero .overlay h1 {
        font-size: 2.4rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .detail-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 18px;
        padding: 2rem;
        margin-bottom: 1.5rem;
    }

    .info-row {
        display: flex;
        gap: 0.8rem;
        align-items: center;
        margin-bottom: 1rem;
        color: var(--text-dim);
    }

    .info-row span.label {
        font-weight: 600;
        color: var(--text-main);
    }

    .cat-badge {
        font-size: 0.8rem;
        font-weight: 700;
        padding: 0.4rem 1rem;
        border-radius: 50px;
        background: rgba(139, 92, 246, 0.2);
        color: #a78bfa;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
    }

    .btn-back {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        color: var(--text-dim);
        border-radius: 8px;
        padding: 0.5rem 1.2rem;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.2s;
    }

    .btn-back:hover {
        color: var(--text-main);
        border-color: var(--accent-color);
    }

    .btn-admin {
        background: rgba(139, 92, 246, 0.2);
        border: 1px solid rgba(139, 92, 246, 0.4);
        color: #a78bfa;
        border-radius: 8px;
        padding: 0.5rem 1.2rem;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.2s;
        margin-left: 0.5rem;
    }

    .btn-admin:hover {
        background: rgba(139, 92, 246, 0.35);
        color: #a78bfa;
    }

    .btn-danger-del {
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid rgba(239, 68, 68, 0.35);
        color: #f87171;
        border-radius: 8px;
        padding: 0.5rem 1.2rem;
        text-decoration: none;
        font-size: 0.9rem;
        margin-left: 0.5rem;
    }

    .btn-danger-del:hover {
        background: rgba(239, 68, 68, 0.3);
        color: #f87171;
    }

    #detail-map {
        height: 300px;
        border-radius: 14px;
        z-index: 1;
    }

    .nearby-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        border-radius: 14px;
        padding: 1rem 1.25rem;
        text-decoration: none;
        color: var(--text-main);
        transition: all 0.25s;
        display: block;
    }

    .nearby-card:hover {
        background: rgba(56, 189, 248, 0.08);
        border-color: rgba(56, 189, 248, 0.3);
        transform: translateY(-2px);
    }

    .btn-navigate {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.7rem 1.5rem;
        background: linear-gradient(135deg, #38bdf8, #818cf8);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
    }

    .btn-navigate:hover {
        transform: scale(1.03);
        box-shadow: 0 6px 25px rgba(56, 189, 248, 0.4);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div style="width:100%; max-width:900px; animation: fadeIn 0.8s ease-out;">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'explorer-list' %}" class="btn-back">‚Üê Back to Explorer</a>
        {% if user.is_staff %}
        <div>
            <a href="{% url 'explorer-edit' place.pk %}" class="btn-admin">‚úèÔ∏è Edit</a>
            <a href="{% url 'explorer-delete' place.pk %}" class="btn-danger-del">üóëÔ∏è Delete</a>
        </div>
        {% endif %}
    </div>

    <div class="detail-hero">
        {% if place.image %}
        <img src="{{ place.image.url }}" alt="{{ place.name }}">
        {% else %}
        <div
            style="height:480px; background:rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; font-size:5rem;">
            üèûÔ∏è</div>
        {% endif %}
        <div class="overlay">
            <div class="cat-badge">{{ place.get_category_display }}</div>
            <h1>{{ place.name }}</h1>
            <p style="color:var(--text-dim); margin:0;">üìç {{ place.location }}</p>
        </div>
    </div>

    <div class="detail-card">
        <h4 style="margin-bottom:1.25rem; color: var(--accent-color);">About this Place</h4>
        <p style="color:var(--text-dim); line-height:1.75; font-size:1rem;">{{ place.description }}</p>
    </div>

    <div class="detail-card">
        <div class="info-row">
            <span>üìç</span><span class="label">Location:</span><span>{{ place.location }}</span>
        </div>
        <div class="info-row">
            <span>üè∑Ô∏è</span><span class="label">Category:</span><span>{{ place.get_category_display }}</span>
        </div>
        <div class="info-row">
            <span>üìÖ</span><span class="label">Added on:</span><span>{{ place.date_added|date:"F j, Y" }}</span>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê Interactive Map & Navigation ‚ïê‚ïê‚ïê -->
    {% if place.latitude and place.longitude %}
    <div class="detail-card">
        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; flex-wrap: wrap; gap: 1rem;">
            <h4 style="margin: 0; color: var(--accent-color);">üìç Location Map</h4>
            <a href="https://www.google.com/maps/dir/?api=1&destination={{ place.latitude }},{{ place.longitude }}"
                target="_blank" rel="noopener" class="btn-navigate">
                üß≠ Navigate Here
            </a>
        </div>
        <div id="detail-map"></div>
        <p style="color: var(--text-dim); font-size: 0.82rem; margin-top: 0.75rem; margin-bottom: 0;">
            Coordinates: {{ place.latitude }}, {{ place.longitude }} ¬∑ Click "Navigate Here" to open GPS directions in
            Google Maps
        </p>
    </div>
    {% endif %}

    <!-- ‚ïê‚ïê‚ïê Nearby Places ‚ïê‚ïê‚ïê -->
    {% if nearby_places %}
    <div class="detail-card">
        <h4 style="margin-bottom: 1.25rem; color: var(--accent-color);">üèòÔ∏è Nearby Places (within 25 km)</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
            {% for np in nearby_places %}
            <a href="{% if np.result_type == 'hill_station' %}{% url 'hill-station-detail' np.pk %}{% else %}{% url 'explorer-detail' np.pk %}{% endif %}"
                class="nearby-card">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.4rem;">
                    <span style="font-weight: 600;">{{ np.name }}</span>
                    <span style="font-size: 0.78rem; color: #38bdf8; white-space: nowrap; margin-left: 0.5rem;">{{
                        np.distance_km }} km</span>
                </div>
                <div style="font-size: 0.82rem; color: var(--text-dim);">
                    <span style="margin-right: 0.5rem;">üìç {% if np.result_type == 'hill_station' %}{{ np.city }}{% else
                        %}{{ np.location }}{% endif %}</span>
                    <span
                        style="background: rgba(139,92,246,0.15); color: #a78bfa; padding: 0.15rem 0.6rem; border-radius: 20px; font-size: 0.72rem;">
                        {% if np.result_type == 'hill_station' %}üèîÔ∏è Hill Station{% else %}{{ np.get_category_display
                        }}{% endif %}
                    </span>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% if place.latitude and place.longitude %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var lat = {{ place.latitude }
    };
    var lng = {{ place.longitude }};
    var map = L.map('detail-map').setView([lat, lng], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    L.marker([lat, lng]).addTo(map)
        .bindPopup('<strong>{{ place.name|escapejs }}</strong><br>{{ place.location|escapejs }}')
        .openPopup();

    {% for np in nearby_places %}
    L.marker([{{ np.latitude }}, {{ np.longitude }}]).addTo(map)
        .bindPopup('<a href="{% url "explorer-detail" np.pk %}" style="font-weight:600;">{{ np.name|escapejs }}</a><br>{{ np.distance_km }} km away');
    {% endfor %}
    });
</script>
{% endif %}
{% endblock %}